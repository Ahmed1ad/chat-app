<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Persistent Chat</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f172a;
  color:#fff;
  height:100vh;
  display:flex;
  flex-direction:column;
}
header{
  background:#020617;
  padding:12px;
  text-align:center;
  font-weight:bold;
}
#chat{
  flex:1;
  padding:10px;
  overflow-y:auto;
}
.msg{
  background:#1e293b;
  margin-bottom:6px;
  padding:8px 10px;
  border-radius:6px;
  word-break:break-word;
}
footer{
  display:flex;
  padding:10px;
  background:#020617;
  gap:6px;
}
input{
  flex:1;
  padding:10px;
  border:none;
  border-radius:6px;
  outline:none;
}
button{
  background:#22c55e;
  border:none;
  padding:10px 14px;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>
<body>

<header>ðŸ’¬ Persistent Chat</header>

<div id="chat"></div>

<footer>
  <input id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
  <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
</footer>


  <script src="/config.js"></script>

<!-- ðŸ”¥ Firebase Module -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    query,
    orderBy,
    onSnapshot,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const firebaseConfig = window.FIREBASE_CONFIG;

  // ðŸš€ Initialize
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const chat = document.getElementById("chat");
  const msgInput = document.getElementById("msg");
  const sendBtn = document.getElementById("sendBtn");

  // ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø§Øª + ØªØ­Ø¯ÙŠØ« Ù„Ø­Ø¸ÙŠ
  const q = query(
    collection(db, "messages"),
    orderBy("time")
  );

  onSnapshot(q, snapshot => {
    chat.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement("div");
      div.className = "msg";
      div.textContent = data.text;
      chat.appendChild(div);
    });
    chat.scrollTop = chat.scrollHeight;
  });

  // ðŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
  sendBtn.onclick = async () => {
    const text = msgInput.value.trim();
    if (!text) return;

    await addDoc(collection(db, "messages"), {
      text: text,
      time: serverTimestamp()
    });

    msgInput.value = "";
  };

  // Enter key
  msgInput.addEventListener("keypress", e => {
    if (e.key === "Enter") sendBtn.click();
  });
</script>

</body>
</html>
