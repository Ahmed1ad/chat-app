<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Chat</title>

<style>
  body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#0f172a;
    color:#fff;
    display:flex;
    flex-direction:column;
    height:100vh;
  }
  header{
    background:#020617;
    padding:12px;
    text-align:center;
    font-weight:bold;
    border-bottom:1px solid #1e293b;
  }
  #chat{
    flex:1;
    padding:10px;
    overflow-y:auto;
  }
  .msg{
    background:#1e293b;
    margin-bottom:8px;
    padding:8px 10px;
    border-radius:6px;
    max-width:85%;
    word-break:break-word;
  }
  .me{
    background:#2563eb;
    margin-left:auto;
  }
  footer{
    display:flex;
    padding:10px;
    background:#020617;
    gap:5px;
    border-top:1px solid #1e293b;
  }
  footer input[type="text"]{
    flex:1;
    padding:10px;
    border:none;
    border-radius:5px;
    outline:none;
  }
  footer input[type="file"]{
    display:none;
  }
  .file-btn{
    background:#334155;
    padding:10px 12px;
    border-radius:5px;
    cursor:pointer;
  }
  button{
    background:#22c55e;
    border:none;
    padding:10px 14px;
    border-radius:5px;
    color:#000;
    font-weight:bold;
    cursor:pointer;
  }
</style>
</head>
<body>

<header>ğŸ’¬ Live Chat</header>

<div id="chat"></div>

<footer>
  <label class="file-btn">
    ğŸ“
    <input type="file" id="file">
  </label>
  <input type="text" id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
  <button onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
</footer>

<script src="/socket.io/socket.io.js"></script>

<script>
const socket = io();
const chat = document.getElementById("chat");
const msgInput = document.getElementById("msg");
const fileInput = document.getElementById("file");

  socket.on("chat-history", history => {
  history.forEach(msg => {
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = msg;
    chat.appendChild(div);
  });
});

socket.on("message", data => {
  const div = document.createElement("div");
  div.className = "msg";
  div.innerHTML = data;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
});

function send(){
  const msg = msgInput.value.trim();

  if(fileInput.files.length){
    const form = new FormData();
    form.append("file", fileInput.files[0]);

    fetch("/upload",{ method:"POST", body:form })
      .then(r=>r.json())
      .then(d=>{
        socket.emit("message",
          `<a href="${d.file}" target="_blank" style="color:#38bdf8">ğŸ“ Ù…Ù„Ù</a>`
        );
      });

    fileInput.value="";
  }

  if(msg){
    socket.emit("message", msg);
    msgInput.value="";
  }
}
</script>

</body>
</html>
